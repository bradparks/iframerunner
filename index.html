<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>iFrame Canvas</title>
    <style>
    html,body,.stage{ height: 100%;}
    </style>
</head>

<body id="home">
    <div class="stage"> 
    </div>
    <script src="lib/jquery-1.7.2.min.js"></script>
    <script src="scripts/timer.js"></script>
    <script src="scripts/runtime.js"></script>
	<script src="scripts/utils.js"></script>
    <script>
    var scriptRun = false;
    if (localStorage.savedScript){
        var script = localStorage.savedScript;
        delete localStorage.savedScript;
        scriptRun = true;
        eval(script);
    }
    window.addEventListener('message', receiveMessage, false);
    function receiveMessage(evt){
		try{
			var message = JSON.parse(evt.data);
		}catch(e){
			console.log('problem parsing %s', evt.data);
			return;
		}
		switch(message.command){
			case 'runscript': return runScript(evt.data.script);
			case 'reset': return reset();
			default: return console.log('unknown command: %o', message);
		}
	}
	
	function reset(){
		delete localStorage.savedScript;
		location.reload();
	}
	
	function runScript(script){
        if (scriptRun){
            localStorage.savedScript = script;
            location.reload();
	}else{
            scriptRun = true;
            eval(script);
        }
    }
    </script>
</body>
</html>
